{% extends "base.html" %}

{% block title %}Supervisor Dashboard - {{ unit_info.unit_name }} - Σύστημα Διαχείρισης Αποθηκών{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="fas fa-warehouse"></i> Αποθήκη: {{ unit_info.unit_name }}</h1>
        <p class="lead">Κωδικός: {{ unit_info.unit_id }}</p>
        {% if is_admin_access %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Προβάλλετε την αποθήκη ως Administrator
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-sm btn-outline-primary ms-2">
                <i class="fas fa-arrow-left"></i> Επιστροφή στο Admin Dashboard
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Statistics Cards -->
<div class="row">
    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-number">{{ employee_count }}</div>
                    <div>Υπάλληλοι</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-users fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-number">{{ unit_info.unit_volume }}</div>
                    <div>Όγκος (m³)</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-cube fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-number">{{ "%.1f"|format(volume_usage_percentage) }}%</div>
                    <div>Χρήση Χώρου</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-chart-pie fa-2x"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="stat-card">
            <div class="d-flex justify-content-between">
                <div>
                    <div class="stat-number {{ 'text-success' if financial_summary.total_realized_gain >= 0 else 'text-danger' }}">{{ "%.2f"|format(financial_summary.total_realized_gain) }}€</div>
                    <div>Πραγματοποιηθέν Κέρδος</div>
                </div>
                <div class="align-self-center">
                    <i class="fas fa-euro-sign fa-2x"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Financial Information -->
<div class="row mt-4">
    <div class="col-12">
        <h3>Οικονομικά Στοιχεία</h3>
    </div>
</div>

<div class="row">
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="fas fa-chart-line"></i> Ανάλυση Κερδών/Ζημιών</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-12 mb-3">
                        <div class="d-flex justify-content-between">
                            <span><strong>Πραγματοποιηθέν Κέρδος από Πωλήσεις:</strong></span>
                            <span class="{{ 'text-success' if financial_summary.total_realized_gain >= 0 else 'text-danger' }}">
                                {{ "%.2f"|format(financial_summary.total_realized_gain) }}€
                            </span>
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="d-flex justify-content-between">
                            <span><strong>Κόστος Τρέχοντος Αποθέματος:</strong></span>
                            <span class="text-warning">{{ "%.2f"|format(financial_summary.total_investment) }}€</span>
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="d-flex justify-content-between">
                            <span><strong>Πιθανά Έσοδα από Απόθεμα:</strong></span>
                            <span class="text-info">{{ "%.2f"|format(financial_summary.total_potential_revenue) }}€</span>
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <div class="d-flex justify-content-between">
                            <span><strong>Πιθανό Κέρδος από Απόθεμα:</strong></span>
                            <span class="{{ 'text-success' if financial_summary.potential_profit_from_stock >= 0 else 'text-danger' }}">
                                {{ "%.2f"|format(financial_summary.potential_profit_from_stock) }}€
                            </span>
                        </div>
                    </div>
                    <hr>
                    <div class="col-12">
                        <div class="d-flex justify-content-between">
                            <span><strong>Συνολικό Πιθανό Κέρδος:</strong></span>
                            <span class="{{ 'text-success' if financial_summary.total_potential_gain >= 0 else 'text-danger' }} fs-5">
                                <strong>{{ "%.2f"|format(financial_summary.total_potential_gain) }}€</strong>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-header">
                <h5><i class="fas fa-info-circle"></i> Επεξήγηση Υπολογισμών</h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <h6><i class="fas fa-calculator"></i> Πώς υπολογίζονται τα κέρδη:</h6>
                    <ul class="mb-0">
                        <li><strong>Πραγματοποιηθέν Κέρδος:</strong> Το κέρδος από προϊόντα που έχουν ήδη πουληθεί (Τιμή Πώλησης - Τιμή Αγοράς) × Ποσότητα</li>
                        <li><strong>Κόστος Αποθέματος:</strong> Το συνολικό κόστος αγοράς του τρέχοντος αποθέματος</li>
                        <li><strong>Πιθανά Έσοδα:</strong> Τα έσοδα αν πουληθεί όλο το τρέχον απόθεμα</li>
                        <li><strong>Πιθανό Κέρδος από Απόθεμα:</strong> Το κέρδος αν πουληθεί όλο το απόθεμα</li>
                        <li><strong>Συνολικό Πιθανό Κέρδος:</strong> Πραγματοποιηθέν + Πιθανό Κέρδος</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-12">
        <h3>Γρήγορες Ενέργειες</h3>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="fas fa-user-plus fa-3x text-primary mb-3"></i>
                <h5 class="card-title">Διαχείριση Υπαλλήλων</h5>
                <p class="card-text">Δημιουργία και διαχείριση υπαλλήλων της αποθήκης</p>
                <a href="{{ url_for('supervisor.view_employees') }}" class="btn btn-primary">Προβολή Υπαλλήλων</a>
                <a href="{{ url_for('supervisor.create_employee') }}" class="btn btn-outline-primary">Νέος Υπάλληλος</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                <h5 class="card-title">Στατιστικά</h5>
                <p class="card-text">Προβολή αναλυτικών στατιστικών αποθήκης</p>
                <a href="{{ url_for('supervisor.unit_statistics') }}" class="btn btn-success">Προβολή Στατιστικών</a>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body text-center">
                <i class="fas fa-shopping-cart fa-3x text-info mb-3"></i>
                <h5 class="card-title">Αγορά Προϊόντων</h5>
                <p class="card-text">Αγορά νέων προϊόντων για την αποθήκη</p>
                <a href="{{ url_for('employee.view_products') }}" class="btn btn-info">Αγορά Προϊόντων</a>
            </div>
        </div>
    </div>
</div>

<!-- Employees Table -->
{% if employees %}
<div class="row mt-4">
    <div class="col-12">
        <h3>Υπάλληλοι Αποθήκης</h3>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Όνομα Χρήστη</th>
                        <th>Όνομα</th>
                        <th>Επίθετο</th>
                        <th>Email</th>
                        <th>Ημερομηνία Εγγραφής</th>
                    </tr>
                </thead>
                <tbody>
                    {% for employee in employees %}
                    <tr>
                        <td><strong>{{ employee.username }}</strong></td>
                        <td>{{ employee.first_name }}</td>
                        <td>{{ employee.last_name }}</td>
                        <td>{{ employee.email }}</td>
                        <td>{{ employee.registration_date.strftime('%d/%m/%Y') if employee.registration_date else 'N/A' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Δεν υπάρχουν υπάλληλοι σε αυτή την αποθήκη.
            <a href="{{ url_for('supervisor.create_employee') }}" class="btn btn-sm btn-primary ms-2">
                Δημιουργία Πρώτου Υπαλλήλου
            </a>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}